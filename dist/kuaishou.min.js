!function(){"use strict";function n(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function t(n){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},t(n)}var e,i,o,s,r,a,c,f,u,l,d,h,m,p;function v(){return i||(i=1,e=function(n,t){var e,i,o;for(e=1;e<arguments.length;e++)for(o in i=arguments[e])i.hasOwnProperty(o)&&(n[o]=i[o]);return n}),e}function g(){if(s)return o;function n(n){if(0===n.length)return n;var t,e,i=n.split(/[_-]/);if(1===i.length&&i[0][0].toLowerCase()===i[0][0])return n;for(e=i[0].toLowerCase(),t=1;t<i.length;t++)e=e+i[t].charAt(0).toUpperCase()+i[t].substring(1).toLowerCase();return e}return s=1,n.prepended=function(t,e){return t+(e=n(e))[0].toUpperCase()+e.substring(1)},o=n}function y(){if(a)return r;a=1;var n=v();return r={build:function(t,e){var i,o,s,r=e.plugins;for(i=0,o=r.length;i<o;i++)(s=r[i]).methods&&n(t,s.methods),s.properties&&Object.defineProperties(t,s.properties)},hook:function(n,t,e){var i,o,s,r,a=n.config.plugins,c=[n.context];for(e&&(c=c.concat(e)),i=0,o=a.length;i<o;i++)r=a[i],(s=a[i][t])&&s.apply(r,c)}},r}function T(){if(h)return d;h=1;var n=v(),t=l?u:(l=1,u=function(n,t,e,i,o){this.message=n,this.transition=t,this.from=e,this.to=i,this.current=o}),e=y(),i=[null,[]];function o(n,t){this.context=n,this.config=t,this.state=t.init.from,this.observers=[n]}return n(o.prototype,{init:function(t){if(n(this.context,this.config.data.apply(this.context,t)),e.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(n){return Array.isArray(n)?n.indexOf(this.state)>=0:this.state===n},isPending:function(){return this.pending},can:function(n){return!this.isPending()&&!!this.seek(n)},cannot:function(n){return!this.can(n)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(n,t){var e=this.config.defaults.wildcard,i=this.config.transitionFor(this.state,n),o=i&&i.to;return"function"==typeof o?o.apply(this.context,t):o===e?this.state:o},fire:function(n,t){return this.transit(n,this.state,this.seek(n,t),t)},transit:function(n,t,e,o){var s=this.config.lifecycle,r=this.config.options.observeUnchangedState||t!==e;return e?this.isPending()?this.context.onPendingTransition(n,t,e):(this.config.addState(e),this.beginTransit(),o.unshift({transition:n,from:t,to:e,fsm:this.context}),this.observeEvents([this.observersForEvent(s.onBefore.transition),this.observersForEvent(s.onBefore[n]),r?this.observersForEvent(s.onLeave.state):i,r?this.observersForEvent(s.onLeave[t]):i,this.observersForEvent(s.on.transition),r?["doTransit",[this]]:i,r?this.observersForEvent(s.onEnter.state):i,r?this.observersForEvent(s.onEnter[e]):i,r?this.observersForEvent(s.on[e]):i,this.observersForEvent(s.onAfter.transition),this.observersForEvent(s.onAfter[n]),this.observersForEvent(s.on[n])],o)):this.context.onInvalidTransition(n,t,e)},beginTransit:function(){this.pending=!0},endTransit:function(n){return this.pending=!1,n},failTransit:function(n){throw this.pending=!1,n},doTransit:function(n){this.state=n.to},observe:function(n){if(2===n.length){var t={};t[n[0]]=n[1],this.observers.push(t)}else this.observers.push(n[0])},observersForEvent:function(n){for(var t,e=0,i=this.observers.length,o=[];e<i;e++)(t=this.observers[e])[n]&&o.push(t);return[n,o,!0]},observeEvents:function(n,t,i,o){if(0===n.length)return this.endTransit(void 0===o||o);var s=n[0][0],r=n[0][1],a=n[0][2];if(t[0].event=s,s&&a&&s!==i&&e.hook(this,"lifecycle",t),0===r.length)return n.shift(),this.observeEvents(n,t,s,o);var c=r.shift(),f=c[s].apply(c,t);return f&&"function"==typeof f.then?f.then(this.observeEvents.bind(this,n,t,s)).catch(this.failTransit.bind(this)):!1===f?this.endTransit(!1):this.observeEvents(n,t,s,f)},onInvalidTransition:function(n,e,i){throw new t("transition is invalid in current state",n,e,i,this.state)},onPendingTransition:function(n,e,i){throw new t("transition is invalid while previous transition is still in progress",n,e,i,this.state)}}),d=o}var b=function(){if(p)return m;p=1;var n=v(),e=g(),i=y(),o=function(){if(f)return c;f=1;var n=v(),e=g();function i(n,t){n=n||{},this.options=n,this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(n.init),this.data=this.configureData(n.data),this.methods=this.configureMethods(n.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(n.transitions||[]),this.plugins=this.configurePlugins(n.plugins,t.plugin)}return n(i.prototype,{addState:function(n){this.map[n]||(this.states.push(n),this.addStateLifecycleNames(n),this.map[n]={})},addStateLifecycleNames:function(n){this.lifecycle.onEnter[n]=e.prepended("onEnter",n),this.lifecycle.onLeave[n]=e.prepended("onLeave",n),this.lifecycle.on[n]=e.prepended("on",n)},addTransition:function(n){this.transitions.indexOf(n)<0&&(this.transitions.push(n),this.addTransitionLifecycleNames(n))},addTransitionLifecycleNames:function(n){this.lifecycle.onBefore[n]=e.prepended("onBefore",n),this.lifecycle.onAfter[n]=e.prepended("onAfter",n),this.lifecycle.on[n]=e.prepended("on",n)},mapTransition:function(n){var t=n.name,e=n.from,i=n.to;return this.addState(e),"function"!=typeof i&&this.addState(i),this.addTransition(t),this.map[e][t]=n,n},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(e){return"string"==typeof e?this.mapTransition(n({},this.defaults.init,{to:e,active:!0})):"object"===t(e)?this.mapTransition(n({},this.defaults.init,e,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(n){return"function"==typeof n?n:"object"===t(n)?function(){return n}:function(){return{}}},configureMethods:function(n){return n||{}},configurePlugins:function(n,t){var e,i,o;for(e=0,i=(n=n||[]).length;e<i;e++)"function"==typeof(o=n[e])&&(n[e]=o=o()),o.configure&&o.configure(this);return n},configureTransitions:function(n){var t,e,i,o,s,r=this.defaults.wildcard;for(e=0;e<n.length;e++)for(i=n[e],o=Array.isArray(i.from)?i.from:[i.from||r],s=i.to||r,t=0;t<o.length;t++)this.mapTransition({name:i.name,from:o[t],to:s})},transitionFor:function(n,t){var e=this.defaults.wildcard;return this.map[n][t]||this.map[e][t]},transitionsFor:function(n){var t=this.defaults.wildcard;return Object.keys(this.map[n]).concat(Object.keys(this.map[t]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),c=i}(),s=T(),r={is:function(n){return this._fsm.is(n)},can:function(n){return this._fsm.can(n)},cannot:function(n){return this._fsm.cannot(n)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(n,t,e){return this._fsm.onInvalidTransition(n,t,e)},onPendingTransition:function(n,t,e){return this._fsm.onPendingTransition(n,t,e)}},a={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(n){throw Error("use transitions to change state")}}};function u(n){return l({},n)}function l(n,t){return d(n,new o(t,u)),n._fsm(),n}function d(o,c){if("object"!==t(o)||Array.isArray(o))throw Error("StateMachine can only be applied to objects");i.build(o,c),Object.defineProperties(o,a),n(o,r),n(o,c.methods),c.allTransitions().forEach((function(n){o[e(n)]=function(){return this._fsm.fire(n,[].slice.call(arguments))}})),o._fsm=function(){this._fsm=new s(this,c),this._fsm.init(arguments)}}return u.version="3.0.1",u.factory=function(){var n,t;"function"==typeof arguments[0]?(n=arguments[0],t=arguments[1]||{}):(n=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var e=new o(t,u);return d(n.prototype,e),n.prototype._fsm.config=e,n},u.apply=l,u.defaults={wildcard:"*",init:{name:"init",from:"none"}},m=u}(),_=n(b);console.show();var k={"首页":"home","去赚钱":"earn","我":"self","朋友":"friend"},w={init:"unlaunch",transitions:[{name:"launch",from:"unlaunch",to:"launched"},{name:"clickHome",from:["launched","friend","earn","self"],to:"home"},{name:"clickFriend",from:["launched","home","earn","self"],to:"friend"},{name:"clickEarn",from:["launched","home","friend","self"],to:"earnLoading"},{name:"clickSelf",from:["launched","home","friend","earn"],to:"self"},{name:"loadedEarn",from:["earnLoading","earn"],to:"earn"},{name:"findAd",from:"earn",to:"adFinding"},{name:"findedAd",from:"adFinding",to:"earn"},{name:"findedAdTaskFail",from:"adFinding",to:"earn"},{name:"clickAdTask",from:"earn",to:"adTaskClicked"},{name:"matchAdType",from:"adTaskClicked",to:"adTypeCheck"},{name:"matchAdType",from:"adTypeCheck",to:"adTypeCheck"},{name:"playAd",from:["adTypeCheck","adAgin"],to:"adPlaying"},{name:"adOk",from:["adPlaying","matchNextType"],to:"adComplete"},{name:"matchComplete",from:["adComplete","liveComplete","matchNextType","liveFollow"],to:"matchNextType"},{name:"backEarn",from:"matchNextType",to:"earn"},{name:"aginAd",from:"matchNextType",to:"adAgin"},{name:"playLive",from:["adTypeCheck","liveAgin"],to:"livePlaying"},{name:"liveOk",from:"livePlaying",to:"liveComplete"},{name:"aginLive",from:"matchNextType",to:"liveAgin"},{name:"followLive",from:"matchNextType",to:"liveFollow"},{name:"goto",from:"*",to:function(n){return n}}],methods:{onBeforeLaunch:function(){return launch("com.kuaishou.nebula")},onLaunched:function n(){setTimeout((function(){var t=function(){if(className("androidx.appcompat.app.ActionBar$c").exists())for(var n=0,t=className("androidx.appcompat.app.ActionBar$c").find();n<t.length;n++){var e=t[n];if(e.selected())return k[e.desc()]}return!1}();t?(x.goto(t),console.log("当前菜单: ".concat(t)),setTimeout((function(){"earn"!==t?x.clickEarn():x.loadedEarn()}),500)):n()}),500)},onClickEarn:function(){!function(n){for(var t=className("androidx.appcompat.app.ActionBar$c").untilFind(),e=0,i=t;e<i.length;e++){var o=i[e];o.desc()===n&&(console.log("点击 ".concat(o.desc())),o.clickBounds())}}("去赚钱")},onEarnLoading:function n(){setTimeout((function(){console.log("加载任务中心..."),className("android.view.View").text("任务中心").exists()?x.loadedEarn():n()}),500)},onLoadedEarn:function(){setTimeout((function(){x.findAd()}),500)},onAdFinding:function n(){setTimeout((function(){console.log("查找广告...");var t=A("看广告");t?t.visibleToUser()?x.findedAd():(swipe(.5*device.width,.8*device.height,.5*device.width,.2*device.height,500),n()):(console.log("未找到看广告任务"),x.findedAdTaskFail())}),1e3)},onFindedAd:function(){setTimeout((function(){x.clickAdTask()}),500)},onAdTaskClicked:function(){var n=A("看广告");n?(console.log("点击看广告"),n.lastChild().clickBounds(),setTimeout((function(){x.matchAdType()}),500)):setTimeout((function(){console.log("未找到看广告任务"),x.backEarn()}),500)},onMatchAdType:function(){setTimeout((function(){id("video_countdown").exists()?x.playAd():id("live_follow_text").exists()?x.playLive():(console.log("广告任务类型,匹配中..."),x.matchAdType())}),1e3)},onAdPlaying:function n(){setTimeout((function(){console.log("观看广告中..."),id("video_countdown").exists()&&id("video_countdown").findOnce().text().includes("已成功领取")?x.adOk():n()}),1e3)},onLivePlaying:function n(){setTimeout((function(){console.log("观看直播中..."),pickup(id("neo_count_down_text"),"text",(function(t){"已领取"===t?x.liveOk():n()}))}),1e3)},onAdComplete:function n(){setTimeout((function(){id("video_countdown").exists()?pickup(id("video_countdown"),"p",(function(n){null!==n?(press(n.centerX(),n.centerY(),10),x.matchComplete()):console.log("未找到领取奖励按钮")})):n()}),500)},onAdAgin:function(){console.log("再次观看广告"),pickup(id("again_medium_icon_dialog_ensure_text"),(function(n){null!==n?(press(n.centerX(),n.centerY(),10),setTimeout((function(){x.playAd()}),500)):console.log("未找到再次观看按钮")}))},onBackEarn:function(){setTimeout((function(){x.clickAdTask()}),500)},onMatchComplete:function(){setTimeout((function(){className("android.view.View").text("任务中心").exists()?x.backEarn():id("again_medium_icon_dialog_ensure_text").exists()?x.aginAd():id("close_dialog_ensure_button").exists()||(id("again_dialog_ensure_text").exists()?x.aginLive():id("video_countdown").exists()?x.adOk():className("android.widget.TextView").text("退出直播间").exists()?x.followLive():(console.log("未匹配类型，重新匹配中..."),x.matchComplete()))}),500)},onLiveComplete:function(){setTimeout((function(){pickup(id("live_audience_clearable_close_container"),(function(n){null!==n?(press(n.centerX(),n.centerY(),10),x.matchComplete()):console.log("未找到领取奖励按钮")}))}),500)},onLiveAgin:function(){pickup(id("again_dialog_ensure_text"),(function(n){null!==n?(press(n.centerX(),n.centerY(),10),setTimeout((function(){x.playLive()}),500)):console.log("未找到再次观看按钮")}))},onLiveFollow:function(){pickup(className("android.widget.TextView").text("退出直播间"),(function(n){null!==n?(press(n.centerX(),n.centerY(),10),setTimeout((function(){x.matchComplete()}),500)):console.log("未找到退出直播间按钮")}))}}},x=new(_.factory(w));function A(n){for(var t=pickup(className("android.view.View").text("日常任务"),"p2").children(),e=0;e<t.size();e++){console.log(t.get(e).id());var i=t.get(e);if(E(i,n))return i}}function E(n,t){if(n.id()&&pickup(n,className("android.widget.TextView")).text().includes(t))return!0}x.launch()}();
